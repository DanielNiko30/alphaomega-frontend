<!DOCTYPE html>
<html>

<head>
  <base href="/">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="frontend">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>frontend</title>
  <link rel="manifest" href="manifest.json">

  <!-- âœ… OneSignal SDK -->
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
</head>

<body>
  <script src="flutter_bootstrap.js" async></script>

  <!-- âœ… Inisialisasi OneSignal Web Push -->
  <script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function () {
      OneSignal.init({
        appId: "257845e8-86e4-466e-b8cb-df95a1005a5f",
        allowLocalhostAsSecureOrigin: true,
        notifyButton: { enable: true },
        welcomeNotification: {
          title: "Selamat datang!",
          message: "Notifikasi siap digunakan."
        }
      });

      // ðŸ”” Event: tampilkan suara custom saat notif muncul
      OneSignal.on('notificationDisplay', function (event) {
        console.log('Notifikasi tampil di web:', event);
        var audio = new Audio('/sounds/cashier.mp3'); // pastikan file ada di web/sounds/
        audio.play().catch(() => console.log("Autoplay diblokir oleh browser"));
      });

      // ðŸ“Œ Event: klik notifikasi
      OneSignal.on('notificationClick', function (event) {
        console.log('Klik notif:', event);
        if (event.data && event.data.idPesanan) {
          // arahkan ke halaman Flutter
          window.location.href = '/#detailPesanan?idPesanan=' + event.data.idPesanan;
        }
      });
    });

    // âœ… Registrasi Service Worker (penting untuk PWA & push)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('flutter_service_worker.js?v=2913101978')
        .then(function (registration) {
          console.log('ServiceWorker registered with scope:', registration.scope);
        }).catch(function (err) {
          console.log('ServiceWorker registration failed:', err);
        });
    }
  </script>
</body>

</html>