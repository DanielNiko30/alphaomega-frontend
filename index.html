<!DOCTYPE html>
<html>

<head>
  <base href="/">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="frontend">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>frontend</title>
  <link rel="manifest" href="manifest.json">

  <!-- OneSignal SDK -->
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
</head>

<body>
  <script src="flutter_bootstrap.js" async></script>

  <script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function () {
      OneSignal.init({
        appId: "257845e8-86e4-466e-b8cb-df95a1005a5f",
        allowLocalhostAsSecureOrigin: true,
        notifyButton: { enable: true },
        welcomeNotification: {
          title: "Selamat datang!",
          message: "Notifikasi siap digunakan."
        }
      });

      // Notifikasi tampil â†’ kirim ke Flutter dan mainkan audio
      OneSignal.on('notificationDisplay', function (event) {
        console.log('Notifikasi tampil di web:', event);

        // Kirim data ke Flutter via postMessage
        window.postMessage({
          type: 'onesignal-notification',
          title: event.heading,
          body: event.content,
          data: event.data
        }, '*');

        // Popup fallback web (optional)
        const div = document.createElement('div');
        div.innerText = (event.heading || "Notifikasi") + " - " + (event.content || "");
        div.style = "position:fixed;bottom:20px;right:20px;background:#0175C2;color:white;padding:10px;border-radius:5px;box-shadow:0 0 10px rgba(0,0,0,0.3);";
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 5000);

        // Audio
        var audio = new Audio('assets/sounds/cashier.mp3');
        audio.play().catch(() => console.log("Autoplay diblokir"));
      });

      // Notifikasi diklik
      OneSignal.on('notificationClick', function (event) {
        console.log('Klik notif:', event);
        if (event.data && event.data.idPesanan) {
          window.location.href = '/#detailPesanan?idPesanan=' + event.data.idPesanan;
        }
      });
    });

    // Registrasi Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('OneSignalSDKWorker.js')
        .then(reg => console.log('SW registered with scope:', reg.scope))
        .catch(err => console.log('SW registration failed:', err));
    }
  </script>
</body>

</html>